<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Retired in a Field</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* CSS Variables for theming */
        :root {
            /* Light theme (default) */
            --bg-gradient-start: #f9f9f9;
            --bg-gradient-end: #f5f5f0;
            --bg-primary: #ffffff;
            --bg-secondary: #fafaf9;
            --bg-tertiary: #f5f5f4;
            --text-primary: #1c1917;
            --text-secondary: #44403c;
            --text-tertiary: #57534e;
            --text-muted: #78716c;
            --text-disabled: #a8a29e;
            --border-primary: #e7e5e4;
            --border-secondary: #d6d3d1;
            --accent-primary: #059669;
            --accent-secondary: #047857;
            --accent-tertiary: #065f46;
            --accent-light: #d1fae5;
            --accent-bg: #f0fdf4;
            --code-bg: #1c1917;
            --code-text: #f5f5f4;
            --inline-code-bg: #f5f5f4;
            --inline-code-text: #dc2626;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 2px 4px rgba(5, 150, 105, 0.2);
            --shadow-lg: 0 4px 8px rgba(5, 150, 105, 0.3);
        }

        /* Dark theme */
        body.dark-theme {
            --bg-gradient-start: #0a0a0a;
            --bg-gradient-end: #1c1917;
            --bg-primary: #1c1917;
            --bg-secondary: #292524;
            --bg-tertiary: #44403c;
            --text-primary: #f5f5f4;
            --text-secondary: #e7e5e4;
            --text-tertiary: #d6d3d1;
            --text-muted: #a8a29e;
            --text-disabled: #78716c;
            --border-primary: #44403c;
            --border-secondary: #57534e;
            --accent-primary: #10b981;
            --accent-secondary: #059669;
            --accent-tertiary: #34d399;
            --accent-light: #064e3b;
            --accent-bg: #022c22;
            --code-bg: #000000;
            --code-text: #f5f5f4;
            --inline-code-bg: #292524;
            --inline-code-text: #34d399;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.3);
            --shadow-md: 0 2px 4px rgba(16, 185, 129, 0.2);
            --shadow-lg: 0 4px 8px rgba(16, 185, 129, 0.3);
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(to bottom, var(--bg-gradient-start), var(--bg-gradient-end));
            color: var(--text-tertiary);
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            font-size: 14px;
            line-height: 1.5;
            transition: background 0.3s ease, color 0.3s ease;
            -webkit-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
            text-size-adjust: 100%;
        }
        
        /* Full-screen game container for mobile */
        #gameContainer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            z-index: 1;
        }
        
        #gameCanvas {
            background-color: #8bc34a; /* Lighter field green */
            display: block;
            width: 100%;
            height: 100%;
            touch-action: none;
        }
        
        .screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            color: var(--text-primary);
            background-color: var(--bg-primary);
            padding: 1rem;
            text-align: center;
            z-index: 10;
            overflow-y: auto;              /* allow scrolling on tall content */
            -webkit-overflow-scrolling: touch; /* smooth iOS scroll */
        }

        /* Add extra top padding for end screen so image isn't flush to top */
        #gameOverScreen {
            /* half of 132px image height = 66px; include safe area inset */
            padding-top: calc(66px + env(safe-area-inset-top, 0px));
        }
        
        #setupScreen {
            display: flex;
            padding-top: 56px;  /* keep content below top controls on mobile */
            padding-bottom: 20px;
            gap: 8px;
        }
        
        #gameOverScreen {
            display: none;
        }
        
        #endingScreen {
            display: none;
        }
        
        /* Preview container for setup screen */
        #previewContainer {
            width: 80%;
            max-width: 400px;
            height: 132px; /* fixed to match image height */
            margin: 1rem 0;
            position: relative;
            background-color: #8bc34a; /* Field green */
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            flex-shrink: 0; /* Prevent compression by flexbox */
            min-height: 132px; /* Ensure minimum height is maintained */
        }
        #setupPreviewImage {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }
        
        .preview-character {
            position: absolute;
            bottom: 10px;
        }
        
        .preview-man {
            left: 20%;
            width: 24px;
            height: 24px;
        }
        
        .preview-cow {
            right: 20%;
            width: 32px;
            height: 32px;
        }
        
        .screen h1 {
            font-size: 1.75rem;
            margin-bottom: 1rem;
            color: var(--accent-primary);
            font-weight: 600;
            width: 100%;
        }
        
        .screen p {
            font-size: 1rem;
            margin-bottom: 1rem;
            text-align: center;
            max-width: 90%;
            line-height: 1.5;
            color: var(--text-secondary);
            width: 100%;
        }

        /* Ensure donations title clears the hamburger */
        #donationsScreen { padding-top: 56px; }
        
        input, button {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            font-size: 16px; /* Prevent iOS Safari zoom on focus */
            padding: 0.75rem 1rem;
            margin: 0.5rem 0;
            border: 1px solid var(--border-primary);
            border-radius: 8px;
            text-align: center;
            min-height: 48px;
            width: 100%;
            max-width: 320px;
        }

        .btn {
            background: var(--accent-primary);
            color: white;
            border: 1px solid var(--accent-primary);
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
            min-width: 200px;
            box-shadow: var(--shadow-md);
            font-size: 16px; /* Prevent iOS zoom */
            padding: 1rem 1.5rem;
        }
        
        .btn:hover {
            background: var(--accent-secondary);
            border-color: var(--accent-secondary);
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        
        #cashAmount {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--accent-primary);
            margin: 1.5rem 0;
            text-align: center;
            width: 100%;
        }
        
        /* Mobile-specific adjustments */
        @media (max-width: 768px) {
            #previewContainer {
                height: 132px; /* keep fixed on mobile too */
                margin: 0.75rem 0;
            }
            
            .preview-man {
                width: 20px;
                height: 20px;
                bottom: 8px;
            }
            
            .preview-cow {
                width: 26px;
                height: 26px;
                bottom: 8px;
            }
            
            .screen h1 {
                font-size: 1.5rem;
                margin-bottom: 0.75rem;
            }
            
            .screen p {
                font-size: 14px;
                margin-bottom: 0.75rem;
            }
            
            .btn {
                font-size: 16px;
                padding: 12px 20px;
                margin: 10px 0;
                min-width: 160px;
            }
            
            #cashAmount {
                font-size: 20px;
                margin: 20px 0;
            }
        }
        
        /* Extra small devices (phones, 320px and down) */
        @media (max-width: 320px) {
            #previewContainer {
                height: 132px; /* keep fixed on very small screens */
                margin: 0.5rem 0;
            }
            
            .preview-man {
                width: 16px;
                height: 16px;
                bottom: 6px;
            }
            
            .preview-cow {
                width: 20px;
                height: 20px;
                bottom: 6px;
            }
            
            .screen h1 {
                font-size: 1.25rem;
                margin-bottom: 0.5rem;
            }
            
            .screen p {
                font-size: 13px;
                margin-bottom: 0.5rem;
            }
            
            .btn {
                font-size: 15px;
                padding: 10px 16px;
                margin: 8px 0;
                min-width: 140px;
            }
            
            #cashAmount {
                font-size: 18px;
                margin: 16px 0;
            }
        }
        
        /* Animation for screen transitions */
        .screen.fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Improved touch feedback */
        .btn:active {
            transform: translateY(1px);
            box-shadow: var(--shadow-sm);
        }
        
        /* Scroll prevention */
        body {
            overscroll-behavior: none;
        }
        
        /* Ensure no text selection on game elements */
        #gameCanvas, .btn {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        /* Safe area handling for modern mobile devices */
        @supports (padding-top: env(safe-area-inset-top)) {
            .screen {
                padding-top: env(safe-area-inset-top);
                padding-right: env(safe-area-inset-right);
                padding-bottom: env(safe-area-inset-bottom);
                padding-left: env(safe-area-inset-left);
            }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas"></canvas>
        
        <!-- Setup Screen -->
        <div id="setupScreen" class="screen fade-in">
              <!-- Preview container with man and cow -->
               <div id="previewContainer">
                    <img id="setupPreviewImage" src="js/riaf.png" alt="Preview: cow and man in a field" />
                </div>
              <!-- Top bar with hamburger menu -->
              <button id="menuButton" class="menuButton" aria-label="Menu" style="position:absolute; top:12px; left:12px; width:44px; height:44px; background: transparent; border: none; color: var(--text-secondary); display:flex; align-items:center; justify-content:center; box-shadow: none; padding:0; opacity:0.8;">
                  <span style="font-size:18px; line-height:1;">‚ò∞</span>
                </button>
                <h1>Retired in a Field</h1>
                <p>In the Age of AI, we're likely to all end up retired in a field.<br />So let‚Äôs get a little practice in.</p>
                <p>Pay to play (you can't win, but you can climb the leaderboard).<br />Money split to Nostr dev projects helped.</p>
                
                <!-- Nostr Login CTA above Cashu token -->
            <p style="max-width:520px; color: var(--text-secondary);">If you'd like to bring your own key, log in with an extension</p>
            <button id="loginNostrSetupButton" class="btn" style="min-width:240px;">Login with Nostr (NIP-07)</button>
            <div id="loginNostrSetupStatus" style="color: var(--text-muted); font-size: 0.9rem; margin-top: 6px; min-height: 1.2em;"></div>

                <!-- Cashu Token Input -->
            <input id="cashuTokenInput" type="text" placeholder="Enter Cashu token" autocomplete="off" spellcheck="false" />
            <div id="cashuTokenNote" style="color: var(--text-muted); font-size: 0.8rem; margin-top: 4px; max-width:320px;">Minibits only for now, 21 min</div>
            <div id="cashuTokenError" style="color:#dc2626; font-size:0.9rem; display:none; max-width:320px;">Token must start with "cashu".</div>
            
            <button id="startButton" class="btn">Start Game</button>
            <div id="leaderboard" style="width:80%; max-width:400px; margin:12px auto 0; padding:10px; border-top:1px solid var(--border-primary);">
                <div id="leaderboardStatus" style="display:flex; align-items:center; gap:8px; color: var(--text-secondary);">
                    <span class="spinner" style="width:14px; height:14px; border:2px solid var(--border-primary); border-top-color:transparent; border-radius:50%; display:inline-block; animation: spin 0.9s linear infinite;"></span>
                    <span>Leaderboard loading‚Ä¶</span>
                </div>
                <div id="leaderboardList" style="margin-top:8px;"></div>
            </div>
        </div>

        <!-- Level Selection Screen -->
        <div id="levelScreen" class="screen" style="display:none; justify-content:center; gap:16px;">
            <h1 style="margin-top:24px;">Level Select</h1>
            <p style="max-width:520px;">Pick a level. Classic chase lives in 1-3, then try the beach drop stampede and laser-eye showdown unlocked for this standalone build.</p>
            <div style="display:flex; gap:12px; flex-wrap:wrap; justify-content:center;">
                <button id="levelBtn1" class="btn" style="font-size:18px; min-width:180px; min-height:88px; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:6px;">
                    <div style="font-size:22px; font-weight:700;">Level 1</div>
                    <div style="font-size:16px; opacity:0.95;">Retired in a Field!</div>
                </button>
                <button id="levelBtn2" class="btn" style="font-size:18px; min-width:180px; min-height:88px; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:6px;">
                    <div style="font-size:22px; font-weight:700;">Level 2</div>
                    <div style="font-size:16px; opacity:0.95;">Retired on a Boat!</div>
                </button>
                <button id="levelBtn3" class="btn" style="font-size:18px; min-width:180px; min-height:88px; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:6px;">
                    <div style="font-size:22px; font-weight:700;">Level 3</div>
                    <div style="font-size:16px; opacity:0.95;">Retired on the Moon!</div>
                </button>
                <button id="levelBtn4" class="btn" style="font-size:18px; min-width:180px; min-height:88px; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:6px;">
                    <div style="font-size:22px; font-weight:700;">Level 4</div>
                    <div style="font-size:16px; opacity:0.95;">Retired on the Beach!</div>
                </button>
                <button id="levelBtn5" class="btn" style="font-size:18px; min-width:180px; min-height:88px; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:6px;">
                    <div style="font-size:22px; font-weight:700;">Level 5</div>
                    <div style="font-size:16px; opacity:0.95;">Laser Eyes Showdown!</div>
                </button>
            </div>
        </div>

        <!-- Level 1 Start Screen -->
        <div id="levelStartScreen" class="screen" style="display:none; flex-direction:column; align-items:center; gap:12px; padding: 24px;">
            <h1 id="levelStartTitle">How to play</h1>
            <p style="max-width:520px; text-align:center;">Click the field and your man will move to that position</p>
            <p style="max-width:520px; text-align:center;">Avoid the cow, if he catches you - you lose!</p>
            <h2 id="levelStartWhy" style="margin-top:8px; color: var(--accent-primary);">Why</h2>
            <p style="max-width:520px; text-align:center; color: var(--accent-primary);">With the rise of AI, you‚Äôve done well, but you no longer have a job!</p>
            <p style="max-width:520px; text-align:center; color: var(--accent-primary);">So you‚Äôre retired to a field. You‚Äôre just looking forward to some quiet time alone, but what‚Äôs that cow looking at‚Ä¶</p>
            <div style="display:flex; gap:12px;">
                <button id="levelStartButton" class="btn" style="min-width:160px;">Start</button>
            </div>
        </div>

        <!-- Level 2 Start Screen -->
        <div id="level2StartScreen" class="screen" style="display:none; flex-direction:column; align-items:center; gap:12px; padding: 24px;">
            <h1>How to play</h1>
            <p style="max-width:520px; text-align:center;">Click the field and your man will move to that position</p>
            <p style="max-width:520px; text-align:center;">Avoid the cows, if they catch you - you lose!</p>
            <h2 style="margin-top:8px; color: var(--accent-primary);">Level 2</h2>
            <p style="max-width:520px; text-align:center; color: var(--accent-primary);">What was that cow‚Äôs problem? Wow. Either way the money you had in bitcoin appreciated, you got sick of being chased round the field and you decided to move on up and retire to a nice quiet boat.</p>
            <p style="max-width:520px; text-align:center; color: var(--accent-primary);">Bliss. But, what‚Äôs that noise‚Ä¶</p>
            <div style="display:flex; gap:12px;">
                <button id="level2StartButton" class="btn" style="min-width:160px;">Start</button>
            </div>
        </div>

        <!-- Level 3 Start Screen -->
        <div id="level3StartScreen" class="screen" style="display:none; flex-direction:column; align-items:center; gap:12px; padding: 24px;">
            <h1>How to play</h1>
            <p style="max-width:520px; text-align:center;">Click the field and your man will move to that position</p>
            <p style="max-width:520px; text-align:center;">Avoid the cows, if they catch you - you lose!</p>
            <h2 style="margin-top:8px; color: var(--accent-primary);">Level 3</h2>
            <p style="max-width:520px; text-align:center; color: var(--accent-primary);">Wow. That is a persistent cow! The bitcoin‚Äôs up though and you‚Äôre sick of this.</p>
            <p style="max-width:520px; text-align:center; color: var(--accent-primary);">You leave the planet and retire on the moon. Sure it‚Äôs lonely but at least that cow can‚Äôt follow you!</p>
            <p style="max-width:520px; text-align:center; color: var(--accent-primary);">What‚Äôs that bounding over the horizon‚Ä¶</p>
            <div style="display:flex; gap:12px;">
                <button id="level3StartButton" class="btn" style="min-width:160px;">Start</button>
            </div>
        </div>

        <!-- Level 4 Start Screen -->
        <div id="level4StartScreen" class="screen" style="display:none; flex-direction:column; align-items:center; gap:12px; padding: 24px;">
            <h1>How to play</h1>
            <p style="max-width:520px; text-align:center;">Tap to move. Dodge the beach drop-ins.</p>
            <p style="max-width:520px; text-align:center;">Every two seconds a wave of cows dives straight down. One touch and it's over.</p>
            <h2 style="margin-top:8px; color: var(--accent-primary);">Level 4</h2>
            <p style="max-width:520px; text-align:center; color: var(--accent-primary);">Retiring on the beach sounded chill‚Äîuntil the herd picked up skydiving.</p>
            <p style="max-width:520px; text-align:center; color: var(--accent-primary);">Survive as the stampede grows denser every other wave.</p>
            <div style="display:flex; gap:12px;">
                <button id="level4StartButton" class="btn" style="min-width:160px;">Start</button>
            </div>
        </div>

        <!-- Level 5 Start Screen -->
        <div id="level5StartScreen" class="screen" style="display:none; flex-direction:column; align-items:center; gap:12px; padding: 24px;">
            <h1>How to play</h1>
            <p style="max-width:520px; text-align:center;">Two cows are back on the chase. Magenta power-ups drop every couple seconds‚Äîgrab one for laser eyes.</p>
            <p style="max-width:520px; text-align:center;">Lasers stun any cow caught in the beam for a second. When they wear off, the stampede resumes.</p>
            <h2 style="margin-top:8px; color: var(--accent-primary);">Level 5</h2>
            <p style="max-width:520px; text-align:center; color: var(--accent-primary);">Retired life unlocks laser-eye surgery, apparently.</p>
            <p style="max-width:520px; text-align:center; color: var(--accent-primary);">Chain beams together or get run down when the cows recover.</p>
            <div style="display:flex; gap:12px;">
                <button id="level5StartButton" class="btn" style="min-width:160px;">Start</button>
            </div>
        </div>

        <!-- Combined End Screen -->
        <div id="gameOverScreen" class="screen">
            <!-- End Screen Image (same size/dimensions as logo/preview) -->
            <div id="endPreviewContainer" style="width:80%; max-width:400px; height:132px; margin: 0 0 12px; position: relative; background-color: #8bc34a; border-radius: 8px; overflow: hidden; box-shadow: var(--shadow-sm); flex-shrink: 0; min-height: 132px;">
                <img src="js/riaf_end_cow.png" alt="Caught by the cow" style="width:100%; height:100%; object-fit: cover; display: block;" />
            </div>
            <h1>Gotcha!</h1>
            <p>Oh no! The cow has caught you!</p>
            <p>It's not easy to be a retired in a field.</p>
            <p>The more you practice the more you'll climb up the leaderboard!</p>
            <p id="scoreMessage">You have scored 21 sats!</p>
            <p id="pointsMessage" style="margin-top:4px;">Points: 0</p>
            <p id="maxSpeedMessage" style="margin-top:2px;">Max Cow Speed: 0.00</p>
            <div id="cashAmount">Your money goes towards supporting Nostr Devs!</div>
            <div style="display:flex; gap:12px; flex-wrap:wrap; justify-content:center; margin-top:8px;">
              <button id="playAgainButton" class="btn">Play Again</button>
              <a href="donations.html" target="_blank" rel="noopener noreferrer" class="btn" style="display:inline-flex; align-items:center; justify-content:center; text-decoration:none;">Donations</a>
            </div>
        </div>

        <!-- Donations Screen -->
        <div id="donationsScreen" class="screen" style="display:none;">
            <button class="menuButton" aria-label="Menu" style="position:absolute; top:12px; left:12px; width:44px; height:44px; background: transparent; border: none; color: var(--text-secondary); display:flex; align-items:center; justify-content:center; box-shadow: none; padding:0; opacity:0.8;">
                <span style="font-size:18px; line-height:1;">‚ò∞</span>
            </button>
            <h1>Donations</h1>
            <p>Thank you for your support. This page will list donation options soon.</p>
        </div>

        <!-- Initials Screen -->
        <div id="initialsScreen" class="screen" style="display: none;">
            <h1>Enter Your Initials</h1>
            <p style="margin-bottom:12px;">Tap arrows to set 3 characters</p>
            <div id="initialsPicker" style="display:flex; gap:16px; align-items:center; justify-content:center; margin: 8px 0 16px;">
                <div class="picker-col" data-index="0" style="display:flex; flex-direction:column; align-items:center; gap:6px;">
                    <button class="picker-up" style="font-size:24px; width:48px; height:40px;">‚ñ≤</button>
                    <div class="picker-char" id="pickerChar0" style="font-size:32px; font-weight:700; width:60px; height:48px; display:flex; align-items:center; justify-content:center; border:1px solid var(--border-primary); border-radius:8px; background:var(--bg-secondary);">A</div>
                    <button class="picker-down" style="font-size:24px; width:48px; height:40px;">‚ñº</button>
                </div>
                <div class="picker-col" data-index="1" style="display:flex; flex-direction:column; align-items:center; gap:6px;">
                    <button class="picker-up" style="font-size:24px; width:48px; height:40px;">‚ñ≤</button>
                    <div class="picker-char" id="pickerChar1" style="font-size:32px; font-weight:700; width:60px; height:48px; display:flex; align-items:center; justify-content:center; border:1px solid var(--border-primary); border-radius:8px; background:var(--bg-secondary);">A</div>
                    <button class="picker-down" style="font-size:24px; width:48px; height:40px;">‚ñº</button>
                </div>
                <div class="picker-col" data-index="2" style="display:flex; flex-direction:column; align-items:center; gap:6px;">
                    <button class="picker-up" style="font-size:24px; width:48px; height:40px;">‚ñ≤</button>
                    <div class="picker-char" id="pickerChar2" style="font-size:32px; font-weight:700; width:60px; height:48px; display:flex; align-items:center; justify-content:center; border:1px solid var(--border-primary); border-radius:8px; background:var(--bg-secondary);">A</div>
                    <button class="picker-down" style="font-size:24px; width:48px; height:40px;">‚ñº</button>
                </div>
            </div>
            <button id="initialsContinueButton" class="btn" style="min-width:240px;">Continue</button>
        </div>
    </div>

    <!-- Game Scripts -->
    <!-- Options Menu Modal -->
    <div id="optionsModal" style="display:none; position:fixed; inset:0; background: rgba(0,0,0,0.5); align-items:center; justify-content:center; z-index:1000;">
      <div style="background: var(--bg-primary); color: var(--text-primary); border: 1px solid var(--border-primary); border-radius: 10px; padding: 16px; width: min(92vw, 380px); box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
          <div style="font-weight:700; font-size:1.1rem;">Options</div>
          <button id="optionsModalClose" aria-label="Close" style="background: transparent; border: none; color: var(--text-secondary); font-size: 22px; line-height: 1; padding: 4px 8px;">√ó</button>
        </div>
        <div style="display:flex; flex-direction:column; gap:8px;">
          <button id="optionsShowKeys" class="btn" style="width:100%;">Show Keys</button>
          <button id="optionsLoginNostr" class="btn" style="width:100%;">Login with Nostr (NIP-07)</button>
          <button id="optionsShowAbout" class="btn" style="width:100%;">About</button>
          <button id="optionsShowDonations" class="btn" style="width:100%;">Donations</button>
          <button id="optionsShowGame" class="btn" style="width:100%;">Game</button>
        </div>
      </div>
    </div>

    <!-- Stats Modal -->
    <div id="statsModal" style="display:none; position:fixed; inset:0; background: rgba(0,0,0,0.5); align-items:center; justify-content:center; z-index:1000;">
      <div style="background: var(--bg-primary); color: var(--text-primary); border: 1px solid var(--border-primary); border-radius: 10px; padding: 16px; width: min(92vw, 420px); box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
          <div style="font-weight:700; font-size:1.1rem;">My Stats</div>
          <button id="statsModalClose" aria-label="Close" style="background: transparent; border: none; color: var(--text-secondary); font-size: 22px; line-height: 1; padding: 4px 8px;">√ó</button>
        </div>
        <div id="statsModalContent" style="display:grid; row-gap:6px; color: var(--text-secondary); word-break: break-word; overflow-wrap: anywhere;"></div>
      </div>
    </div>
    <!-- Keys Modal -->
    <div id="keysModal" style="display:none; position:fixed; inset:0; background: rgba(0,0,0,0.5); align-items:center; justify-content:center; z-index:1000;">
      <div style="background: var(--bg-primary); color: var(--text-primary); border: 1px solid var(--border-primary); border-radius: 10px; padding: 16px; width: min(92vw, 520px); box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
          <div style="font-weight:700; font-size:1.1rem;">Session Keys</div>
          <button id="keysModalClose" aria-label="Close" style="background: transparent; border: none; color: var(--text-secondary); font-size: 22px; line-height: 1; padding: 4px 8px;">√ó</button>
        </div>
        <div id="keysModalNpub" style="font-family: ui-monospace, SFMono-Regular, Menlo, monospace; padding:6px 8px; border:1px solid var(--border-primary); border-radius:6px; background: var(--inline-code-bg); margin-bottom:6px; max-width:100%; white-space: nowrap; overflow-x: auto; overflow-y: hidden;"></div>
        <div style="display:flex; gap:8px; align-items:center;">
          <div id="keysModalNsec" style="flex:1; font-family: ui-monospace, SFMono-Regular, Menlo, monospace; padding:6px 8px; border:1px solid var(--border-primary); border-radius:6px; background: var(--inline-code-bg); max-width:100%; white-space: nowrap; overflow-x: auto; overflow-y: hidden;"></div>
          <button id="keysModalToggle" class="btn" aria-label="Reveal private key" style="white-space:nowrap; padding:0; min-width: auto; font-size:16px; width:36px; height:36px; display:flex; align-items:center; justify-content:center;">üëÅ</button>
        </div>
        <div style="margin-top:8px; font-size:0.85rem; color: var(--text-muted);">Stored in session only; cleared when the tab closes.</div>
      </div>
    </div>

    <!-- Optional local config (gitignored). Copy js/config.sample.js to js/config.local.js and set CVM_SERVER_PUBKEY. -->
    <script src="js/config.local.js"></script>
    <script src="js/nostr.js"></script>
    <script src="js/cvm-client.browser.js"></script>
    
    
    <script src="js/game-config.js"></script>
    <script src="js/graphics.js"></script>
    <script src="js/controls.js"></script>
    <script src="js/initials.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/game-engine.js"></script>
</body>
</html>
